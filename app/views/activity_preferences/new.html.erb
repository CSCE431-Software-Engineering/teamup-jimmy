<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <%= stylesheet_link_tag 'navbar', media: 'all', 'data-turbolinks-track': 'reload' %>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />
  <title>Jimmy</title>
</head>

<body>
  <%= render 'pages/navbar_inner_page' %>

  <div class="container">
    <div class="general-div-main">
      <div class="general-div-inner">


        <h1 class="profile-name">Search For Activities </h1>
        <br>

        <div class="search-bar">
          <%= text_field_tag :query, params[:query], placeholder: "Soccer", id: 'search-input' %>
        </div>

        <script>
          document.addEventListener('turbo:load', function() {
            const searchInput = document.getElementById('search-input');
            const activityRows = document.querySelectorAll('#activities_list tr[data-activity-name]');

            searchInput.addEventListener('input', function() {
              const searchQuery = searchInput.value.toLowerCase();

              var lastRow = null;
              activityRows.forEach(function(row) {
                // Retrieve the activity name from the data-activity-name attribute
                const activityName = row.getAttribute('data-activity-name').toLowerCase();
                row.classList.remove('edit-workout-pref-table-add-tr');
                row.classList.remove('edit-workout-pref-table-tr');
                row.classList.add('edit-workout-pref-table-tr');
                if (activityName.includes(searchQuery)) {
                  row.style.display = ''; // Show the row if it matches
                  lastRow = row;
                } else {
                  row.style.display = 'none'; // Hide the row if it doesn't match
                }
              });

              lastRow.classList.remove('edit-workout-pref-table-tr');
              lastRow.classList.add('edit-workout-pref-table-add-tr');
            });
          });
        </script>
        <div class="general-div-inner">
          <br>
          <div class="edit-workoutpref-div">
            <table summary="Added activities" id = "activities_list" class="edit-workoutpref-table">
              <% @activities.each do |activity|%>
                <% if activity != @activities.last %>
                  <tr data-activity-name="<%= activity.activity_name.downcase %>" class = "edit-workout-pref-table-tr">
                    <td class = "edit-form-label edit-form-subscript"><%=activity.activity_name%></th>
                    <td class = "table-icon"> 
                      <%= button_to(experience_activity_preference_path(activity), method: :get, class: "material-symbols-outlined edit-workoutpref-add-btn") do %>
                        <%= image_tag asset_path("add_icon.png"), class: "table-icon", alt: "Add item" %>
                      <% end %>
                    <td>
                  </tr>
                <% else %>
                  <tr data-activity-name="<%= activity.activity_name.downcase %>" class = "edit-workout-pref-table-add-tr">
                    <td class = "edit-form-label edit-form-subscript"><%=activity.activity_name%></th>
                    <td class = "table-icon"> 
                      <%= button_to(experience_activity_preference_path(activity), method: :get, class: "material-symbols-outlined edit-workoutpref-add-btn") do %>
                        <%= image_tag asset_path("add_icon.png"), class: "table-icon", alt: "Add item" %>
                      <% end %>
                    <td>
                  </tr>
                <% end %>
              <%end%>
            </table>
          </div>
        </div>
      <br>
      </div>
    </div>
  </div>
</div>

</body>